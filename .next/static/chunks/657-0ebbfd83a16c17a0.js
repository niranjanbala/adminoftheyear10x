(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[657],{285:(e,t,r)=>{"use strict";r.d(t,{$:()=>l});var i=r(5155),a=r(2115),n=r(9708),s=r(2085),o=r(9434);let c=(0,s.F)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=a.forwardRef((e,t)=>{let{className:r,variant:a,size:s,asChild:l=!1,...d}=e,u=l?n.DX:"button";return(0,i.jsx)(u,{className:(0,o.cn)(c({variant:a,size:s,className:r})),ref:t,...d})});l.displayName="Button"},1760:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=1760,e.exports=t},3155:(e,t,r)=>{"use strict";r.d(t,{M:()=>o});var i=r(5155),a=r(2115),n=r(285),s=r(5031);function o(e){let{variant:t="default",size:r="default",className:o,children:c}=e,{signInWithHubSpot:l,loading:d}=(0,s.A)(),[u,f]=(0,a.useState)(!1),h=async()=>{try{f(!0),await l()}catch(e){console.error("Login failed:",e)}finally{f(!1)}};return(0,i.jsx)(n.$,{variant:t,size:r,className:o,onClick:h,disabled:d||u,children:u?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,i.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,i.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Connecting..."]}):c||(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 24 24",fill:"currentColor",children:(0,i.jsx)("path",{d:"M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm5.568 8.16c-.169 1.858-.896 3.433-2.043 4.568-1.258 1.249-2.97 1.93-4.814 1.93-1.843 0-3.556-.681-4.814-1.93-1.147-1.135-1.874-2.71-2.043-4.568-.027-.312.207-.576.52-.576h.896c.261 0 .48.183.53.437.123 1.25.634 2.394 1.434 3.188.8.794 1.87 1.232 3.014 1.232s2.214-.438 3.014-1.232c.8-.794 1.311-1.938 1.434-3.188.05-.254.269-.437.53-.437h.896c.313 0 .547.264.52.576z"})}),"Sign in with HubSpot"]})})}},5031:(e,t,r)=>{"use strict";r.d(t,{A:()=>c,AuthProvider:()=>o});var i=r(5155),a=r(2115),n=r(3579);let s=(0,a.createContext)(void 0);function o(e){let{children:t}=e,[r,o]=(0,a.useState)(null),[c,l]=(0,a.useState)(!0),[d]=(0,a.useState)(()=>(0,n.createClientComponentClient)());(0,a.useEffect)(()=>{if(!d)return void l(!1);(async()=>{try{let{data:{session:e}}=await d.auth.getSession();(null==e?void 0:e.user)&&await u(e.user.id)}catch(e){console.error("Error getting initial session:",e)}finally{l(!1)}})();let{data:{subscription:e}}=d.auth.onAuthStateChange(async(e,t)=>{"SIGNED_IN"===e&&(null==t?void 0:t.user)?await u(t.user.id):"SIGNED_OUT"===e&&o(null),l(!1)});return()=>e.unsubscribe()},[d]);let u=async e=>{if(d)try{let{data:t,error:r}=await d.from("users").select("*").eq("id",e).single();if(r)throw r;o({id:t.id,email:t.email,hubspot_id:t.hubspot_id,display_name:t.display_name,role:t.role,verification_status:t.verification_status})}catch(e){console.error("Error fetching user profile:",e),o(null)}},f=async()=>{try{l(!0);let e=await fetch("/api/auth/hubspot/initiate",{method:"GET"});if(!e.ok)throw Error("Failed to initiate HubSpot authentication");let{authUrl:t}=await e.json();window.location.href=t}catch(e){throw console.error("HubSpot sign-in error:",e),l(!1),e}},h=async()=>{if(d)try{l(!0),await fetch("/api/auth/logout",{method:"POST"}),await d.auth.signOut(),o(null)}catch(e){throw console.error("Sign out error:",e),e}finally{l(!1)}},p=async()=>{try{if(!(await fetch("/api/auth/refresh",{method:"POST"})).ok)throw Error("Failed to refresh tokens")}catch(e){throw console.error("Token refresh error:",e),e}};return(0,i.jsx)(s.Provider,{value:{user:r,loading:c,signInWithHubSpot:f,signOut:h,refreshTokens:p},children:t})}function c(){let e=(0,a.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},6117:(e,t,r)=>{"use strict";r.d(t,{O:()=>o});var i=r(5155),a=r(5031),n=r(3155),s=r(6695);function o(e){let{children:t,requireRole:r,requireVerified:o=!1,fallback:c}=e,{user:l,loading:d}=(0,a.A)();if(d)return(0,i.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,i.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary"})});if(!l)return c||(0,i.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,i.jsxs)(s.Zp,{className:"w-full max-w-md",children:[(0,i.jsxs)(s.aR,{className:"text-center",children:[(0,i.jsx)(s.ZB,{className:"text-2xl font-bold",children:"Sign In Required"}),(0,i.jsx)(s.BT,{children:"You need to sign in with your HubSpot account to access this page."})]}),(0,i.jsx)(s.Wu,{children:(0,i.jsx)(n.M,{className:"w-full"})})]})});if(o&&"verified"!==l.verification_status)return(0,i.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,i.jsx)(s.Zp,{className:"w-full max-w-md",children:(0,i.jsxs)(s.aR,{className:"text-center",children:[(0,i.jsx)("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-yellow-100",children:(0,i.jsx)("svg",{className:"h-6 w-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,i.jsx)(s.ZB,{className:"text-2xl font-bold",children:"Account Verification Required"}),(0,i.jsxs)(s.BT,{children:["Your HubSpot account needs to be verified before you can access this feature.","pending"===l.verification_status&&" Verification is currently pending.","rejected"===l.verification_status&&" Your verification was rejected. Please contact support."]})]})})});if(r){let e={participant:0,voter:1,organizer:2,super_admin:3};if(e[l.role]<e[r])return(0,i.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:(0,i.jsx)(s.Zp,{className:"w-full max-w-md",children:(0,i.jsxs)(s.aR,{className:"text-center",children:[(0,i.jsx)("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-red-100",children:(0,i.jsx)("svg",{className:"h-6 w-6 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,i.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728L5.636 5.636m12.728 12.728L18.364 5.636M5.636 18.364l12.728-12.728"})})}),(0,i.jsx)(s.ZB,{className:"text-2xl font-bold",children:"Access Denied"}),(0,i.jsxs)(s.BT,{children:["You don't have the required permissions to access this page. Required role: ",r.replace("_"," ")]})]})})})}return(0,i.jsx)(i.Fragment,{children:t})}},6126:(e,t,r)=>{"use strict";r.d(t,{E:()=>o});var i=r(5155);r(2115);var a=r(2085),n=r(9434);let s=(0,a.F)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function o(e){let{className:t,variant:r,...a}=e;return(0,i.jsx)("div",{className:(0,n.cn)(s({variant:r}),t),...a})}},6695:(e,t,r)=>{"use strict";r.d(t,{BT:()=>l,Wu:()=>d,ZB:()=>c,Zp:()=>s,aR:()=>o});var i=r(5155),a=r(2115),n=r(9434);let s=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",r),...a})});s.displayName="Card";let o=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",r),...a})});o.displayName="CardHeader";let c=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,i.jsx)("h3",{ref:t,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",r),...a})});c.displayName="CardTitle";let l=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,i.jsx)("p",{ref:t,className:(0,n.cn)("text-sm text-muted-foreground",r),...a})});l.displayName="CardDescription";let d=a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,n.cn)("p-6 pt-0",r),...a})});d.displayName="CardContent",a.forwardRef((e,t)=>{let{className:r,...a}=e;return(0,i.jsx)("div",{ref:t,className:(0,n.cn)("flex items-center p-6 pt-0",r),...a})}).displayName="CardFooter"},8947:(e,t,r)=>{"use strict";r.d(t,{lX:()=>c,x:()=>l});var i=r(2354),a=r(9509);let n=a.env.NEXT_PUBLIC_SUPABASE_URL||"https://placeholder.supabase.co",s=a.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"placeholder-key",o=(0,i.UU)(n,s),c={async getAll(e){let t=new URLSearchParams;(null==e?void 0:e.tier)&&t.append("tier",e.tier),(null==e?void 0:e.country)&&t.append("country",e.country),(null==e?void 0:e.status)&&t.append("status",e.status);let r=await fetch("/api/competitions?".concat(t.toString()));if(!r.ok)throw Error("Failed to fetch competitions");return r.json()},async getById(e){let t=await fetch("/api/competitions/".concat(e));if(!t.ok){if(404===t.status)return null;throw Error("Failed to fetch competition")}return t.json()},async create(e){let t=await fetch("/api/competitions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw Error((await t.json()).error||"Failed to create competition");return t.json()},async update(e,t){let r=await fetch("/api/competitions/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!r.ok)throw Error((await r.json()).error||"Failed to update competition");return r.json()},async getLeaderboard(e){let{data:t,error:r}=await o.rpc("get_competition_leaderboard",{comp_id:e});if(r)throw r;return t},async getStats(e){let{data:t,error:r}=await o.rpc("get_competition_stats",{comp_id:e});if(r)throw r;return t[0]},async validateDates(e){let{data:t,error:r}=await o.rpc("validate_competition_dates",{reg_start:e.registration_start,reg_end:e.registration_end,vote_start:e.voting_start,vote_end:e.voting_end});if(r)throw r;return t}},l={async getByCompetition(e){let{data:t,error:r}=await o.from("participations").select("\n        *,\n        user:users(*)\n      ").eq("competition_id",e).order("vote_count",{ascending:!1});if(r)throw r;return t},async getByUser(e){let{data:t,error:r}=await o.from("participations").select("\n        *,\n        competition:competitions(*)\n      ").eq("user_id",e).order("applied_at",{ascending:!1});if(r)throw r;return t},async create(e){let{data:t,error:r}=await o.from("participations").insert(e).select().single();if(r)throw r;return t},async update(e,t){let{data:r,error:i}=await o.from("participations").update(t).eq("id",e).select().single();if(i)throw i;return r},async approve(e){return this.update(e,{status:"approved",approved_at:new Date().toISOString()})},async reject(e){return this.update(e,{status:"rejected"})}}},9434:(e,t,r)=>{"use strict";r.d(t,{cn:()=>n});var i=r(2596),a=r(9688);function n(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return(0,a.QP)((0,i.$)(t))}}}]);